# 排行榜 API 測試流程指南

## 🎯 測試目標

確認以下功能正常運作：
1. 後端 API 可以接收請求
2. 資料正確寫入 MySQL 資料庫
3. 排行榜查詢功能正常

---

## 📋 完整測試流程（建議順序）

### 第 0 步：⚠️ 重要提示

**不要直接開啟 HTML 檔案！**
- ❌ 不要用檔案總管雙擊 HTML 檔案
- ❌ 會出現 `ERR_FILE_NOT_FOUND` 錯誤
- ✅ 必須使用 HTTP 伺服器開啟

---

### 第 1 步：啟動所有伺服器（推薦）

**方法 1：一鍵啟動所有伺服器（最簡單）**
```
雙擊：D:\網頁\website\START_ALL_SERVERS.bat
```
這會同時啟動：
- 後端 API 伺服器 (port 3000)
- 前端測試伺服器 (port 8080)

**方法 2：分別啟動**

先啟動後端：
```
雙擊：D:\網頁\website\START_LEADERBOARD_NEW_WINDOW.bat
```

再啟動前端：
```
雙擊：D:\網頁\website\START_FRONTEND_SERVER.bat
```

**確認成功：**
- 後端視窗看到：`📡 Listening on port 3000`
- 前端視窗看到：`Serving HTTP on ... port 8080`

---

### 第 2 步：開啟測試頁面

**使用瀏覽器開啟：**
```
http://localhost:8080/leaderboard-test.html
```

或點擊啟動腳本後自動開啟的頁面。

**確認成功：** 頁面顯示「後端狀態：已連接」

---

### 第 3 步：測試獲取排行榜

1. 在測試頁面點擊「**獲取排行榜**」按鈕
2. 應該看到 JSON 格式的回應，包含：
   - Alice (分數 400)
   - Bob (分數 295)
   - Charlie (分數 275)

---

### 第 4 步：測試提交分數

1. 填寫：
   - 用戶 ID: `1`
   - 分數: `50`
2. 點擊「**提交分數**」
3. 應該看到成功訊息

---

### 第 5 步：用 SQL 驗證資料

**方法 1：使用快速腳本**
```
雙擊：D:\網頁\website\backend\SQL_快速指令.bat
```

**方法 2：手動開啟**
```bash
mysql -u root leaderboard_db
```

**執行查詢：**
```sql
-- 查看 Alice 的總分（應該從 400 變成 450）
SELECT * FROM user_total_loves WHERE user_id = 1;

-- 查看最新的分數記錄
SELECT * FROM love_scores ORDER BY created_at DESC LIMIT 5;
```

**確認成功：**
- `total_loves` 應該是 450
- `love_scores` 表有新的一筆記錄

---

### 第 6 步：再次獲取排行榜確認

1. 回到測試頁面
2. 再次點擊「**獲取排行榜**」
3. Alice 的分數應該更新為 450

---

## ✅ 完整測試檢查清單

- [ ] 後端伺服器成功啟動
- [ ] 測試頁面顯示「已連接」
- [ ] 能夠獲取排行榜資料
- [ ] 能夠提交分數
- [ ] SQL 查詢顯示資料已更新
- [ ] 排行榜分數正確更新

---

## 🔧 故障排除

### 問題 1：後端無法連接

**檢查：**
1. 後端伺服器是否已啟動？
2. 終端機是否顯示「Listening on port 3000」？
3. MySQL 服務是否啟動？

**解決：**
```bash
# 檢查 3000 端口是否被占用
netstat -ano | findstr :3000

# 如果被占用，殺掉進程
taskkill /F /PID <進程ID>
```

### 問題 2：提交分數失敗「User not found」

**原因：** 用戶不存在

**解決：** 用 SQL 新增用戶
```sql
INSERT INTO users (id, username) VALUES (1, 'Alice');
```

### 問題 3：SQL 連接失敗

**檢查：**
1. MySQL 服務是否啟動？
2. 資料庫是否存在？

**解決：**
```bash
# 重新建立資料庫
mysql -u root < D:/網頁/website/backend/database/schema-simplified.sql
```

---

## 📚 相關檔案位置

| 檔案 | 路徑 |
|------|------|
| 測試頁面 | `D:\網頁\website\frontend\leaderboard-test.html` |
| 啟動腳本 | `D:\網頁\website\START_LEADERBOARD_NEW_WINDOW.bat` |
| SQL 教學 | `D:\網頁\website\backend\SQL_基礎教學.md` |
| SQL 腳本 | `D:\網頁\website\backend\SQL_快速指令.bat` |
| 常用查詢 | `D:\網頁\website\backend\database\常用查詢.sql` |

---

## 💡 進階測試

### 測試不同的用戶

```sql
-- 新增更多測試用戶
INSERT INTO users (id, username) VALUES
(4, '小明'),
(5, '小華');
```

然後在測試頁面為這些用戶提交分數。

### 測試大量資料

```sql
-- 批量新增分數記錄
INSERT INTO love_scores (user_id, love_count, action_type, created_at)
SELECT
    FLOOR(1 + RAND() * 3) AS user_id,
    FLOOR(50 + RAND() * 200) AS love_count,
    'default',
    NOW()
FROM
    (SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5) t1,
    (SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5) t2
LIMIT 20;

-- 更新總分
INSERT INTO user_total_loves (user_id, total_loves, last_updated)
SELECT user_id, SUM(love_count), NOW()
FROM love_scores
GROUP BY user_id
ON DUPLICATE KEY UPDATE
    total_loves = VALUES(total_loves),
    last_updated = NOW();
```

---

## 🎓 學習重點

測試過程中你會學到：

1. **API 如何運作**
   - 前端發送請求
   - 後端處理並回應
   - 資料寫入資料庫

2. **SQL 的實際應用**
   - 查詢資料驗證
   - 新增測試資料
   - 理解資料表關聯

3. **除錯技巧**
   - 查看終端機日誌
   - 用 SQL 驗證資料
   - 比對 API 回應

---

## 🎉 測試成功！

如果所有步驟都通過，恭喜你！

**你已經成功：**
- ✅ 建立並部署了排行榜 API
- ✅ 學會用 SQL 查詢和驗證資料
- ✅ 理解前後端如何協作

**下一步可以做：**
1. 嘗試修改測試頁面的樣式
2. 新增更多測試用戶和分數
3. 學習更進階的 SQL 查詢
4. 將排行榜整合到你的主網站

加油！🚀
