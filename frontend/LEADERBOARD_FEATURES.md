# 愛心排行榜功能說明

## 新功能概覽

您的網站左側排行榜已經完成升級,現在包含以下新功能:

### ✨ 主要功能

#### 1. 🏆 前三名獎盃顯示
- **第1名**: 🏆 金色獎盃 (帶金色光暈效果)
- **第2名**: 🥈 銀色獎盃 (帶銀色光暈效果)
- **第3名**: 🥉 銅色獎盃 (帶銅色光暈效果)
- 前三名項目有特殊的閃光動畫效果

#### 2. 📊 展開/收起功能
- **默認顯示**: 前10名玩家
- **展開模式**: 點擊按鈕可查看最多100名玩家
- **平滑過渡**: 展開和收起都有流暢的動畫效果
- **智能按鈕**: 按鈕會顯示當前顯示人數/總人數

#### 3. 🔥 玩家名稱編輯
- 點擊名字旁的 ✏️ 圖標可編輯自己的名稱
- 名稱限制: 2-20個字元
- 自動同步到 Firebase 後端

#### 4. 🔄 自動更新
- 每5秒自動從後端刷新排行榜數據
- 實時顯示最新排名

#### 5. 📍 當前玩家高亮
- 您的排名會以特殊顏色高亮顯示
- 底部顯示您的當前排名

## 技術實現

### 後端連接
- ✅ 已連接到 Firebase Firestore
- ✅ API 端點: `http://localhost:3000/api/leaderboard`
- ✅ 自動回退機制: 後端失敗時使用 LocalStorage

### 數據格式
排行榜數據支持以下格式:
```javascript
{
  username: "玩家名稱",
  totalLoves: 100,  // 或 score / total_loves
  user_id: "user_123"
}
```

### CSS 樣式類
- `.rank-trophy` - 獎盃樣式
- `.gold-trophy` - 金色獎盃特效
- `.silver-trophy` - 銀色獎盃特效
- `.bronze-trophy` - 銅色獎盃特效
- `.top-three` - 前三名項目特殊效果
- `.current-user` - 當前用戶高亮
- `.side-leaderboard.expanded` - 展開狀態

## 使用說明

### 查看排行榜
1. 排行榜固定在頁面左側
2. 默認顯示前10名玩家
3. 向下滾動可查看更多(如果展開)

### 展開完整排行榜
1. 點擊排行榜底部的「▼ 查看完整排行榜」按鈕
2. 排行榜會展開顯示最多100名玩家
3. 點擊「▲ 收起排行榜」恢復默認顯示

### 編輯名稱
1. 點擊底部您名字旁的 ✏️ 圖標
2. 在彈出窗口中輸入新名稱(2-20個字元)
3. 點擊「確認」保存
4. 名稱會自動同步到服務器

### 查看排名
- 您的當前排名顯示在排行榜底部
- 如果您在前10名,您的項目會有特殊高亮
- 前三名會顯示獎盃圖標

## 布局優化

### 定位
- 位置: 固定在左上角,時段顯示器下方
- 寬度: 280px
- 最大高度: 根據螢幕自動調整,確保不超出視窗

### 不遮擋內容
- Z-index: 998 (在主內容上方,在對話框下方)
- 半透明背景: rgba(40, 40, 50, 0.90)
- 毛玻璃效果: backdrop-filter blur(15px)

### 響應式設計
- 手機版(<600px): 自動隱藏排行榜
- 滾動條: 自定義樣式,不會太突兀

## API 端點

### 獲取排行榜
```
GET /api/leaderboard?limit=100
```

### 獲取用戶排名
```
GET /api/leaderboard/my-rank/{userId}
```

### 更新用戶名稱
```
PUT /api/leaderboard/username
Body: {
  userId: string,
  newUsername: string
}
```

## 瀏覽器兼容性

- ✅ Chrome / Edge (最佳效果)
- ✅ Firefox
- ✅ Safari
- ⚠️ IE11 (不支持部分CSS效果)

## 性能優化

1. **數據緩存**: 排行榜數據緩存在內存中,減少不必要的重新渲染
2. **節流更新**: 自動更新間隔5秒,避免過度請求
3. **平滑動畫**: 使用 CSS transition 而非 JavaScript 動畫
4. **虛擬滾動**: 只渲染可見區域的項目(展開100人時)

## 故障排查

### 排行榜不顯示
- 檢查後端服務器是否運行 (localhost:3000)
- 查看瀏覽器控制台是否有錯誤
- 確認 Firebase 配置正確

### 無法更新名稱
- 確認後端 API 可訪問
- 檢查名稱長度是否符合要求(2-20字元)

### 展開按鈕不出現
- 確認排行榜數據超過10人
- 檢查 JavaScript 是否正確加載

## 未來改進建議

- [ ] 添加排名變化動畫(上升/下降箭頭)
- [ ] 個人歷史排名圖表
- [ ] 分類排行榜(日榜/週榜/月榜)
- [ ] 成就徽章系統
- [ ] 排行榜分享功能

---

**最後更新**: 2025-10-30
**版本**: 2.0
**開發者**: Claude Code
