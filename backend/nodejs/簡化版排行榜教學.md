# ç°¡åŒ–ç‰ˆæ’è¡Œæ¦œç³»çµ± - å®Œæ•´æ•™å­¸

## ğŸ¯ ç°¡ä»‹

é€™æ˜¯ä¸€å€‹**ç°¡åŒ–ç‰ˆ**çš„æ’è¡Œæ¦œç³»çµ±ï¼Œä½¿ç”¨ **Node.js + MySQL** æ¶æ§‹ã€‚
ç›¸æ¯”åŸæœ¬çš„è¤‡é›œç‰ˆæœ¬ï¼ˆPHP + Node.js + MySQL + Redisï¼‰ï¼Œé€™å€‹ç‰ˆæœ¬ï¼š

- âœ… **åªç”¨ä¸€ç¨®å¾Œç«¯èªè¨€**ï¼ˆNode.js/JavaScriptï¼‰
- âœ… **ä¸éœ€è¦ Redis**ï¼ˆæ¸›å°‘ä¸€å€‹è»Ÿé«”ï¼‰
- âœ… **æ›´å®¹æ˜“ç†è§£å’Œå­¸ç¿’**
- âœ… **é©åˆä¸­å°è¦æ¨¡ä½¿ç”¨**ï¼ˆå¹¾åƒåˆ°å¹¾è¬ç­†è¨˜éŒ„ï¼‰

---

## ğŸ“ ç³»çµ±æ¶æ§‹

```
å‰ç«¯ (ç¶²é )
    â†“ å‘¼å« API
Node.js Express ä¼ºæœå™¨
    â†“ æŸ¥è©¢è³‡æ–™åº«
MySQL è³‡æ–™åº«
```

### æª”æ¡ˆçµæ§‹

```
D:\ç¶²é \website/
â”œâ”€â”€ START_LEADERBOARD.bat          # ä¸€éµå•Ÿå‹•è…³æœ¬
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ nodejs/                    # Node.js å¾Œç«¯
â”‚   â”‚   â”œâ”€â”€ server.js              # ä¸»ä¼ºæœå™¨
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â””â”€â”€ database.js        # è³‡æ–™åº«é…ç½®
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ leaderboard.service.js  # æ’è¡Œæ¦œé‚è¼¯
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â””â”€â”€ leaderboard.routes.js   # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ package.json           # ä¾è³´ç®¡ç†
â”‚   â”‚   â””â”€â”€ .env                   # ç’°å¢ƒè®Šæ•¸
â”‚   â””â”€â”€ database/
â”‚       â””â”€â”€ schema-simplified.sql  # ç°¡åŒ–ç‰ˆè³‡æ–™åº«çµæ§‹
â””â”€â”€ frontend/                      # å‰ç«¯æª”æ¡ˆ
```

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### æ–¹æ³• 1ï¼šä¸€éµå•Ÿå‹•ï¼ˆæ¨è–¦ï¼‰

é›™æ“Š `START_LEADERBOARD.bat` å³å¯ï¼

### æ–¹æ³• 2ï¼šæ‰‹å‹•å•Ÿå‹•

1. **å•Ÿå‹• MySQL æœå‹™**
2. **é–‹å•Ÿå‘½ä»¤æç¤ºå­—å…ƒ**
3. **åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š**

```bash
cd D:\ç¶²é \website\backend\nodejs
npm start
```

4. **ç­‰å¾…å‡ºç¾ä»¥ä¸‹è¨Šæ¯ï¼š**

```
ğŸš€ Simplified Leaderboard API Server
ğŸ“¡ Listening on port 3000
âœ… MySQL connected

ğŸ“‹ Available endpoints:
   GET  http://localhost:3000/api/leaderboard
   GET  http://localhost:3000/api/leaderboard/my-rank/:userId
   GET  http://localhost:3000/api/leaderboard/around/:userId
   POST http://localhost:3000/api/leaderboard/submit
```

5. **ä¼ºæœå™¨æˆåŠŸå•Ÿå‹•ï¼**

---

## ğŸ“¡ API ä½¿ç”¨èªªæ˜

### 1. ç²å–æ’è¡Œæ¦œ

**è«‹æ±‚ï¼š**
```http
GET http://localhost:3000/api/leaderboard?page=1&limit=10
```

**å›æ‡‰ç¯„ä¾‹ï¼š**
```json
{
  "success": true,
  "page": 1,
  "limit": 10,
  "total": 3,
  "total_pages": 1,
  "data": [
    {
      "rank": 1,
      "user_id": 1,
      "username": "Alice",
      "score": 400
    },
    {
      "rank": 2,
      "user_id": 2,
      "username": "Bob",
      "score": 295
    }
  ]
}
```

### 2. ç²å–å€‹äººæ’å

**è«‹æ±‚ï¼š**
```http
GET http://localhost:3000/api/leaderboard/my-rank/1
```

**å›æ‡‰ç¯„ä¾‹ï¼š**
```json
{
  "success": true,
  "user_id": 1,
  "username": "Alice",
  "rank": 1,
  "score": 400,
  "total_users": 3,
  "percentile": "100.00%"
}
```

### 3. æäº¤åˆ†æ•¸

**è«‹æ±‚ï¼š**
```http
POST http://localhost:3000/api/leaderboard/submit
Content-Type: application/json

{
  "user_id": 1,
  "score": 50
}
```

**å›æ‡‰ç¯„ä¾‹ï¼š**
```json
{
  "success": true,
  "score_id": 8,
  "user_id": 1,
  "score": 50,
  "message": "Score submitted successfully"
}
```

---

## ğŸ—„ï¸ è³‡æ–™åº«çµæ§‹

### 1. users è¡¨ï¼ˆç”¨æˆ¶è¡¨ï¼‰

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| id | INT | ç”¨æˆ¶IDï¼ˆä¸»éµï¼‰ |
| username | VARCHAR(50) | ç”¨æˆ¶åç¨± |
| created_at | TIMESTAMP | å»ºç«‹æ™‚é–“ |
| updated_at | TIMESTAMP | æ›´æ–°æ™‚é–“ |

### 2. love_scores è¡¨ï¼ˆåˆ†æ•¸è¨˜éŒ„è¡¨ï¼‰

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| id | BIGINT | è¨˜éŒ„IDï¼ˆä¸»éµï¼‰ |
| user_id | INT | ç”¨æˆ¶IDï¼ˆå¤–éµï¼‰ |
| love_count | INT | æ„›å¿ƒæ•¸é‡ |
| action_type | VARCHAR(50) | éŠæˆ²é¡å‹ |
| created_at | TIMESTAMP | å»ºç«‹æ™‚é–“ |

### 3. user_total_loves è¡¨ï¼ˆç¸½åˆ†æ•¸å¿«å–è¡¨ï¼‰

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| user_id | INT | ç”¨æˆ¶IDï¼ˆä¸»éµï¼‰ |
| total_loves | INT | ç¸½æ„›å¿ƒæ•¸ |
| last_updated | TIMESTAMP | æœ€å¾Œæ›´æ–°æ™‚é–“ |

**ç‚ºä»€éº¼éœ€è¦å¿«å–è¡¨ï¼Ÿ**
- æŸ¥è©¢æ’è¡Œæ¦œæ™‚ï¼Œç›´æ¥å¾é€™å€‹è¡¨è®€å–ç¸½åˆ†ï¼Œé€Ÿåº¦æ›´å¿«
- ä¸éœ€è¦æ¯æ¬¡éƒ½ `SUM()` è¨ˆç®—ï¼Œæ•ˆèƒ½æå‡ 10 å€ä»¥ä¸Š

---

## ğŸ”§ å¾Œç«¯é‹ä½œåŸç†

### 1. ä¼ºæœå™¨å•Ÿå‹•æµç¨‹

```
1. è¼‰å…¥ç’°å¢ƒè®Šæ•¸ (.env)
   â†“
2. é€£æ¥ MySQL è³‡æ–™åº«
   â†“
3. è¨­å®š API è·¯ç”±
   â†“
4. å•Ÿå‹• Express ä¼ºæœå™¨ï¼ˆç›£è½ 3000 ç«¯å£ï¼‰
```

### 2. API è«‹æ±‚è™•ç†æµç¨‹

**ä»¥ã€Œç²å–æ’è¡Œæ¦œã€ç‚ºä¾‹ï¼š**

```
å‰ç«¯ç™¼é€è«‹æ±‚
   â†“
routes/leaderboard.routes.jsï¼ˆæ¥æ”¶è«‹æ±‚ï¼Œé©—è­‰åƒæ•¸ï¼‰
   â†“
services/leaderboard.service.jsï¼ˆæŸ¥è©¢è³‡æ–™åº«ï¼‰
   â†“
MySQL æŸ¥è©¢ï¼š
   SELECT u.id, u.username, t.total_loves
   FROM user_total_loves t
   INNER JOIN users u ON t.user_id = u.id
   ORDER BY t.total_loves DESC
   LIMIT 10
   â†“
çµ„è£å›æ‡‰ JSON
   â†“
å›å‚³çµ¦å‰ç«¯
```

### 3. æäº¤åˆ†æ•¸çš„é‚è¼¯

ç•¶ç”¨æˆ¶æäº¤åˆ†æ•¸æ™‚ï¼š

1. **æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å­˜åœ¨**
2. **æ’å…¥è¨˜éŒ„åˆ° `love_scores` è¡¨**ï¼ˆä¿å­˜æ¯æ¬¡çš„åˆ†æ•¸ï¼‰
3. **æ›´æ–° `user_total_loves` è¡¨**ï¼ˆç´¯åŠ ç¸½åˆ†ï¼‰

ä½¿ç”¨ SQLï¼š
```sql
INSERT INTO user_total_loves (user_id, total_loves, last_updated)
VALUES (1, 50, NOW())
ON DUPLICATE KEY UPDATE
  total_loves = total_loves + VALUES(total_loves),
  last_updated = NOW()
```

é€™å€‹èªæ³•çš„æ„æ€ï¼š
- å¦‚æœç”¨æˆ¶ä¸å­˜åœ¨ â†’ æ–°å¢è¨˜éŒ„
- å¦‚æœç”¨æˆ¶å·²å­˜åœ¨ â†’ ç´¯åŠ åˆ†æ•¸

---

## ğŸ’¡ å¸¸è¦‹å•é¡Œ

### Q1: å¦‚ä½•æ–°å¢æ¸¬è©¦ç”¨æˆ¶ï¼Ÿ

**æ–¹æ³• 1ï¼šç”¨ MySQL æŒ‡ä»¤**
```sql
INSERT INTO users (id, username) VALUES (4, 'ä½ çš„åå­—');
```

**æ–¹æ³• 2ï¼šç”¨ phpMyAdmin æˆ–å…¶ä»– GUI å·¥å…·**

### Q2: å¦‚ä½•æ¸…ç©ºæ’è¡Œæ¦œï¼Ÿ

```sql
TRUNCATE TABLE love_scores;
TRUNCATE TABLE user_total_loves;
```

### Q3: ä¼ºæœå™¨å•Ÿå‹•å¤±æ•—æ€éº¼è¾¦ï¼Ÿ

**æª¢æŸ¥æ¸…å–®ï¼š**
1. MySQL æœå‹™æ˜¯å¦å•Ÿå‹•ï¼Ÿ
2. `.env` æª”æ¡ˆçš„è³‡æ–™åº«å¯†ç¢¼æ˜¯å¦æ­£ç¢ºï¼Ÿ
3. 3000 ç«¯å£æ˜¯å¦è¢«ä½”ç”¨ï¼Ÿ

**æŸ¥çœ‹ 3000 ç«¯å£ä½”ç”¨ï¼š**
```bash
netstat -ano | findstr :3000
```

**æ®ºæ‰ä½”ç”¨é€²ç¨‹ï¼š**
```bash
taskkill /F /PID <é€²ç¨‹ID>
```

### Q4: å¦‚ä½•ä¿®æ”¹ä¼ºæœå™¨ç«¯å£ï¼Ÿ

ç·¨è¼¯ `.env` æª”æ¡ˆï¼š
```
PORT=3001  # æ”¹æˆä½ æƒ³è¦çš„ç«¯å£
```

### Q5: å¦‚ä½•é‡è¨­è³‡æ–™åº«ï¼Ÿ

```bash
mysql -u root
```

```sql
DROP DATABASE leaderboard_db;
SOURCE D:/ç¶²é /website/backend/database/schema-simplified.sql;
```

---

## ğŸ“š å­¸ç¿’é‡é»

### 1. ä»€éº¼æ˜¯å¾Œç«¯ï¼Ÿ

å¾Œç«¯å°±åƒé¤å»³çš„å»šæˆ¿ï¼š
- **å‰ç«¯**ï¼ˆç¶²é ï¼‰= é¤å»³å¤–å ´ï¼ˆå®¢äººçœ‹å¾—åˆ°çš„åœ°æ–¹ï¼‰
- **å¾Œç«¯**ï¼ˆNode.jsï¼‰= å»šæˆ¿ï¼ˆè™•ç†è¨‚å–®ã€æº–å‚™é¤é»ï¼‰
- **è³‡æ–™åº«**ï¼ˆMySQLï¼‰= å€‰åº«ï¼ˆå„²å­˜é£Ÿæï¼‰

### 2. ä»€éº¼æ˜¯ APIï¼Ÿ

API å°±åƒé¤å»³çš„èœå–®ï¼š
- èœå–®ä¸Šæœ‰ã€Œç‰›è‚‰éºµã€ã€ã€Œç‚’é£¯ã€
- API æœ‰ `/api/leaderboard`ã€`/api/leaderboard/submit`

å‰ç«¯é€é APIã€Œé»é¤ã€ï¼Œå¾Œç«¯ã€Œæº–å‚™é¤é»ã€ä¸¦å›å‚³ã€‚

### 3. ç‚ºä»€éº¼éœ€è¦è³‡æ–™åº«ï¼Ÿ

å¦‚æœæ²’æœ‰è³‡æ–™åº«ï¼š
- é—œé–‰ä¼ºæœå™¨ â†’ æ‰€æœ‰åˆ†æ•¸éƒ½æ¶ˆå¤±ï¼

æœ‰äº†è³‡æ–™åº«ï¼š
- åˆ†æ•¸æ°¸ä¹…ä¿å­˜åœ¨ç¡¬ç¢Ÿä¸­
- éš¨æ™‚å¯ä»¥æŸ¥è©¢ã€æ’åºã€çµ±è¨ˆ

### 4. ä»€éº¼æ˜¯å¿«å–è¡¨ï¼Ÿ

**æ²’æœ‰å¿«å–è¡¨ï¼š**
```sql
-- æ¯æ¬¡æŸ¥æ’è¡Œæ¦œéƒ½è¦è¨ˆç®—ç¸½åˆ†ï¼ˆæ…¢ï¼‰
SELECT user_id, SUM(love_count) as total
FROM love_scores
GROUP BY user_id
ORDER BY total DESC
```

**æœ‰å¿«å–è¡¨ï¼š**
```sql
-- ç›´æ¥è®€å–å·²ç®—å¥½çš„ç¸½åˆ†ï¼ˆå¿«ï¼‰
SELECT user_id, total_loves
FROM user_total_loves
ORDER BY total_loves DESC
```

---

## ğŸ” é€²éšå­¸ç¿’

### 1. å¦‚ä½•æ–°å¢åŠŸèƒ½ï¼Ÿ

**ç¯„ä¾‹ï¼šæ–°å¢ã€Œæ¯é€±æ’è¡Œæ¦œã€**

**æ­¥é©Ÿï¼š**
1. åœ¨ `services/leaderboard.service.js` æ–°å¢æ–¹æ³•
2. åœ¨ `routes/leaderboard.routes.js` æ–°å¢è·¯ç”±
3. æ¸¬è©¦ API

### 2. å¦‚ä½•å„ªåŒ–æ•ˆèƒ½ï¼Ÿ

**ç›®å‰çš„ç“¶é ¸ï¼š**
- æŸ¥è©¢æ’è¡Œæ¦œæ™‚ï¼Œæ¯æ¬¡éƒ½å¾ MySQL è®€å–

**å„ªåŒ–æ–¹æ¡ˆï¼š**
- åŠ å…¥ Redis å¿«å–ï¼ˆé€²éšï¼‰
- å®šæ™‚é‡å»ºæ’è¡Œæ¦œï¼ˆæ¯å°æ™‚æ›´æ–°ä¸€æ¬¡ï¼‰

### 3. å¦‚ä½•éƒ¨ç½²åˆ°ç¶²è·¯ä¸Šï¼Ÿ

**é¸é … 1ï¼šç§Ÿç”¨é›²ç«¯ä¸»æ©Ÿ**
- AWSã€Google Cloudã€Azure
- éœ€è¦è¨­å®šé˜²ç«ç‰†ã€é–‹æ”¾ 3000 ç«¯å£

**é¸é … 2ï¼šä½¿ç”¨ Herokuã€Railway ç­‰å¹³å°**
- æ›´ç°¡å–®ï¼Œä½†æœ‰é™åˆ¶

---

## ğŸ“ ç¸½çµ

æ­å–œä½ å®Œæˆç°¡åŒ–ç‰ˆæ’è¡Œæ¦œç³»çµ±ï¼

**ä½ å·²ç¶“å­¸æœƒï¼š**
âœ… Node.js å¾Œç«¯ä¼ºæœå™¨
âœ… Express æ¡†æ¶
âœ… MySQL è³‡æ–™åº«
âœ… REST API è¨­è¨ˆ
âœ… å‰å¾Œç«¯åˆ†é›¢æ¶æ§‹

**ä¸‹ä¸€æ­¥å­¸ç¿’æ–¹å‘ï¼š**
1. å­¸ç¿’ Redis å¿«å–
2. å­¸ç¿’ç”¨æˆ¶è¨»å†Š/ç™»å…¥
3. å­¸ç¿’éƒ¨ç½²åˆ°é›²ç«¯
4. å­¸ç¿’ Docker å®¹å™¨åŒ–

åŠ æ²¹ï¼ğŸš€
