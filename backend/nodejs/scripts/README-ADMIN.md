# æŽ’è¡Œæ¦œç®¡ç†ç³»çµ±ä½¿ç”¨èªªæ˜Ž

## ðŸ“‹ ç›®éŒ„

1. [ç®¡ç†è…³æœ¬ä½¿ç”¨æ–¹æ³•](#ç®¡ç†è…³æœ¬ä½¿ç”¨æ–¹æ³•)
2. [ç®¡ç† API ç«¯é»ž](#ç®¡ç†-api-ç«¯é»ž)
3. [ç¶²é ç®¡ç†å¾Œå°](#ç¶²é ç®¡ç†å¾Œå°)
4. [æ³¨æ„äº‹é …](#æ³¨æ„äº‹é …)

---

## ç®¡ç†è…³æœ¬ä½¿ç”¨æ–¹æ³•

### 1. æŸ¥çœ‹æ‰€æœ‰çŽ©å®¶

```bash
cd D:\ç¶²é \website\backend\nodejs
node scripts/view-players.js
```

é¡¯ç¤ºæ‰€æœ‰çŽ©å®¶çš„æŽ’åã€IDã€åç¨±ã€åˆ†æ•¸å’Œæœ€å¾Œæ›´æ–°æ™‚é–“ã€‚

### 2. åˆªé™¤ç‰¹å®šçŽ©å®¶

```bash
node scripts/delete-player.js
```

**åŠŸèƒ½ï¼š**
- åˆªé™¤çŽ©å®¶çš„æ‰€æœ‰è³‡æ–™ï¼ˆusersã€userTotalsã€scoresï¼‰
- è‡ªå‹•æ›´æ–° metadata çµ±è¨ˆ
- åŒ…å«äºŒæ¬¡ç¢ºèªæ©Ÿåˆ¶

**ç¯„ä¾‹ï¼š**
```
è«‹è¼¸å…¥è¦åˆªé™¤çš„çŽ©å®¶ ID: user_1234567890_abc
ðŸ“Š çŽ©å®¶è³‡æ–™:
   åç¨±: æ¸¬è©¦çŽ©å®¶
   ç¸½åˆ†: 1500
â“ ç¢ºå®šè¦åˆªé™¤æ­¤çŽ©å®¶å—Žï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŽŸï¼(yes/no): yes
âœ… çŽ©å®¶å·²å®Œå…¨åˆªé™¤ï¼
```

### 3. é‡ç½®çŽ©å®¶åˆ†æ•¸

```bash
node scripts/reset-player-score.js
```

**åŠŸèƒ½ï¼š**
- å°‡çŽ©å®¶åˆ†æ•¸é‡ç½®ç‚º 0
- å¯é¸æ“‡æ˜¯å¦åˆªé™¤æ­·å²åˆ†æ•¸è¨˜éŒ„
- ä¿ç•™çŽ©å®¶åŸºæœ¬è³‡æ–™

**ç¯„ä¾‹ï¼š**
```
è«‹è¼¸å…¥è¦é‡ç½®åˆ†æ•¸çš„çŽ©å®¶ ID: user_1234567890_abc
ðŸ“Š çŽ©å®¶è³‡æ–™:
   åç¨±: æ¸¬è©¦çŽ©å®¶
   ç•¶å‰ç¸½åˆ†: 1500
â“ ç¢ºå®šè¦é‡ç½®æ­¤çŽ©å®¶çš„åˆ†æ•¸ç‚º 0 å—Žï¼Ÿ(yes/no): yes
âœ… åˆ†æ•¸å·²é‡ç½®ç‚º 0
â“ æ˜¯å¦åŒæ™‚åˆªé™¤è©²çŽ©å®¶çš„æ‰€æœ‰æ­·å²åˆ†æ•¸è¨˜éŒ„ï¼Ÿ(yes/no): no
```

### 4. æ¸…ç©ºæ•´å€‹æŽ’è¡Œæ¦œ

```bash
node scripts/clear-leaderboard.js
```

**åŠŸèƒ½ï¼š**
- åˆªé™¤æ‰€æœ‰çŽ©å®¶è³‡æ–™
- é‡ç½® metadata çµ±è¨ˆ
- åŒ…å«å¤šé‡ç¢ºèªæ©Ÿåˆ¶

**ç¯„ä¾‹ï¼š**
```
ðŸ“Š ç•¶å‰è³‡æ–™çµ±è¨ˆ:
   users é›†åˆ: 10 ç­†
   userTotals é›†åˆ: 10 ç­†
   scores é›†åˆ: 50 ç­†
âš ï¸âš ï¸âš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œå°‡åˆªé™¤æ‰€æœ‰çŽ©å®¶è³‡æ–™ä¸”ç„¡æ³•å¾©åŽŸï¼âš ï¸âš ï¸âš ï¸
ç¢ºèªè¦æ¸…ç©ºæŽ’è¡Œæ¦œå—Žï¼Ÿ(yes/no): yes
å†æ¬¡ç¢ºèªï¼šçœŸçš„è¦åˆªé™¤æ‰€æœ‰è³‡æ–™å—Žï¼Ÿè«‹è¼¸å…¥ "DELETE ALL" ä¾†ç¢ºèª: DELETE ALL
âœ… æŽ’è¡Œæ¦œå·²å®Œå…¨æ¸…ç©ºï¼
```

---

## ç®¡ç† API ç«¯é»ž

### Base URL
```
http://localhost:3000/api/leaderboard
```

### 1. ç²å–æ‰€æœ‰çŽ©å®¶åˆ—è¡¨

**GET** `/admin/players`

**æŸ¥è©¢åƒæ•¸ï¼š**
- `page` - é ç¢¼ï¼ˆé è¨­ï¼š1ï¼‰
- `limit` - æ¯é æ•¸é‡ï¼ˆé è¨­ï¼š50ï¼Œæœ€å¤§ï¼š200ï¼‰

**ç¯„ä¾‹è«‹æ±‚ï¼š**
```bash
curl "http://localhost:3000/api/leaderboard/admin/players?page=1&limit=50"
```

**å›žæ‡‰ï¼š**
```json
{
  "success": true,
  "page": 1,
  "limit": 50,
  "total": 10,
  "total_pages": 1,
  "data": [
    {
      "rank": 1,
      "user_id": "user_1234567890_abc",
      "username": "æ¸¬è©¦çŽ©å®¶",
      "total_score": 1500,
      "last_updated": "2025-01-15T10:30:00.000Z"
    }
  ]
}
```

### 2. åˆªé™¤ç‰¹å®šçŽ©å®¶

**DELETE** `/admin/player/:userId`

**ç¯„ä¾‹è«‹æ±‚ï¼š**
```bash
curl -X DELETE "http://localhost:3000/api/leaderboard/admin/player/user_1234567890_abc"
```

**å›žæ‡‰ï¼š**
```json
{
  "success": true,
  "user_id": "user_1234567890_abc",
  "username": "æ¸¬è©¦çŽ©å®¶",
  "deleted_scores": 5,
  "message": "Player deleted successfully"
}
```

### 3. é‡ç½®çŽ©å®¶åˆ†æ•¸

**POST** `/admin/reset-score`

**è«‹æ±‚é«”ï¼š**
```json
{
  "userId": "user_1234567890_abc",
  "deleteHistory": false
}
```

**ç¯„ä¾‹è«‹æ±‚ï¼š**
```bash
curl -X POST "http://localhost:3000/api/leaderboard/admin/reset-score" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "user_1234567890_abc",
    "deleteHistory": false
  }'
```

**å›žæ‡‰ï¼š**
```json
{
  "success": true,
  "user_id": "user_1234567890_abc",
  "username": "æ¸¬è©¦çŽ©å®¶",
  "old_score": 1500,
  "new_score": 0,
  "deleted_history": false,
  "deleted_scores": 0,
  "message": "Score reset successfully"
}
```

### 4. æ¸…ç©ºæ•´å€‹æŽ’è¡Œæ¦œ

**POST** `/admin/clear-all`

**è«‹æ±‚é«”ï¼š**
```json
{
  "confirm": "DELETE ALL"
}
```

**ç¯„ä¾‹è«‹æ±‚ï¼š**
```bash
curl -X POST "http://localhost:3000/api/leaderboard/admin/clear-all" \
  -H "Content-Type: application/json" \
  -d '{"confirm": "DELETE ALL"}'
```

**å›žæ‡‰ï¼š**
```json
{
  "success": true,
  "message": "Leaderboard cleared successfully",
  "stats": {
    "users": 10,
    "userTotals": 10,
    "scores": 50,
    "total": 70
  }
}
```

---

## ç¶²é ç®¡ç†å¾Œå°

### è¨ªå•æ–¹å¼

1. å•Ÿå‹•å¾Œç«¯ä¼ºæœå™¨ï¼š
```bash
cd D:\ç¶²é \website\backend\nodejs
npm start
```

2. æ‰“é–‹ç€è¦½å™¨è¨ªå•ï¼š
```
http://localhost:3000/admin.html
```

### åŠŸèƒ½ä»‹ç´¹

#### 1. çµ±è¨ˆå„€è¡¨æ¿
- é¡¯ç¤ºç¸½çŽ©å®¶æ•¸
- é¡¯ç¤ºç•¶å‰é é¢å’Œç¸½é æ•¸
- å³æ™‚æ›´æ–°çµ±è¨ˆè³‡æ–™

#### 2. çŽ©å®¶åˆ—è¡¨
- é¡¯ç¤ºæ‰€æœ‰çŽ©å®¶çš„æŽ’åã€IDã€åç¨±ã€åˆ†æ•¸
- æœå°‹åŠŸèƒ½ï¼šå¯æŒ‰çŽ©å®¶ ID æˆ–åç¨±æœå°‹
- åˆ†é ç€è¦½ï¼šæ¯é é¡¯ç¤º 50 ç­†

#### 3. æ“ä½œåŠŸèƒ½
- **é‡ç½®åˆ†æ•¸**ï¼šå°‡ç‰¹å®šçŽ©å®¶åˆ†æ•¸æ­¸é›¶
  - å¯é¸æ“‡æ˜¯å¦åŒæ™‚åˆªé™¤æ­·å²è¨˜éŒ„
  - åŒ…å«ç¢ºèªå°è©±æ¡†

- **åˆªé™¤çŽ©å®¶**ï¼šå®Œå…¨ç§»é™¤çŽ©å®¶è³‡æ–™
  - åˆªé™¤æ‰€æœ‰ç›¸é—œè³‡æ–™
  - åŒ…å«ç¢ºèªå°è©±æ¡†

- **æ¸…ç©ºæŽ’è¡Œæ¦œ**ï¼šåˆªé™¤æ‰€æœ‰çŽ©å®¶è³‡æ–™
  - éœ€è¦è¼¸å…¥ "DELETE ALL" ç¢ºèª
  - å¤šé‡ç¢ºèªæ©Ÿåˆ¶

#### 4. å³æ™‚é€šçŸ¥
- æ“ä½œæˆåŠŸ/å¤±æ•—æœƒé¡¯ç¤º Toast é€šçŸ¥
- è‡ªå‹•æ¶ˆå¤±ï¼Œç„¡éœ€æ‰‹å‹•é—œé–‰

---

## æ³¨æ„äº‹é …

### âš ï¸ å®‰å…¨æ€§

1. **èº«ä»½é©—è­‰**
   - ç›®å‰ç®¡ç†å¾Œå°**æ²’æœ‰å¯†ç¢¼ä¿è­·**
   - å»ºè­°åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­æ·»åŠ èº«ä»½é©—è­‰
   - å¯è€ƒæ…®ä½¿ç”¨ HTTP Basic Auth æˆ– API å¯†é‘°

2. **è¨ªå•æŽ§åˆ¶**
   - ä¸è¦å…¬é–‹ç®¡ç†å¾Œå°çš„ URL
   - å»ºè­°ä½¿ç”¨é˜²ç«ç‰†é™åˆ¶è¨ªå• IP
   - è€ƒæ…®éƒ¨ç½²åœ¨å…§éƒ¨ç¶²è·¯

3. **CORS è¨­å®š**
   - ç¢ºä¿ CORS è¨­å®šæ­£ç¢º
   - é¿å…å…è¨±æ‰€æœ‰ä¾†æºï¼ˆ`*`ï¼‰

### ðŸ”’ è³‡æ–™ä¿è­·

1. **å‚™ä»½æ©Ÿåˆ¶**
   - åŸ·è¡Œæ¸…ç©ºæ“ä½œå‰å…ˆå‚™ä»½è³‡æ–™
   - ä½¿ç”¨ Firebase Console çš„åŒ¯å‡ºåŠŸèƒ½
   - å®šæœŸå‚™ä»½ Firestore è³‡æ–™

2. **ç„¡æ³•å¾©åŽŸ**
   - æ‰€æœ‰åˆªé™¤æ“ä½œ**ç„¡æ³•å¾©åŽŸ**
   - åŸ·è¡Œå‰è«‹ä»”ç´°ç¢ºèª
   - æ¸¬è©¦ç’°å¢ƒå…ˆè¡Œé©—è­‰

### ðŸ“Š Firebase é…é¡

1. **è®€å–é…é¡**
   - å…è²»ç‰ˆæ¯æ—¥ 50,000 æ¬¡è®€å–
   - ç®¡ç†å¾Œå°æ¯æ¬¡è¼‰å…¥ç´„æ¶ˆè€— 50-200 æ¬¡è®€å–
   - é¿å…é »ç¹é‡æ–°è¼‰å…¥

2. **å¯«å…¥é…é¡**
   - å…è²»ç‰ˆæ¯æ—¥ 20,000 æ¬¡å¯«å…¥
   - åˆªé™¤æ“ä½œæœƒæ¶ˆè€—è¼ƒå¤šé…é¡
   - æ‰¹æ¬¡åˆªé™¤æ™‚æ³¨æ„é…é¡é™åˆ¶

3. **å»ºè­°**
   - ä½¿ç”¨å¿«å–æ¸›å°‘è®€å–æ¬¡æ•¸
   - é¿å…åœ¨é«˜å³°æœŸåŸ·è¡Œå¤§é‡åˆªé™¤
   - ç›£æŽ§ Firebase Console çš„é…é¡ä½¿ç”¨æƒ…æ³

### ðŸ› ï¸ æ•…éšœæŽ’é™¤

#### å•é¡Œ 1ï¼šç„¡æ³•é€£æŽ¥åˆ° API
```
è§£æ±ºæ–¹æ³•ï¼š
1. ç¢ºèªå¾Œç«¯ä¼ºæœå™¨æ­£åœ¨é‹è¡Œï¼ˆnpm startï¼‰
2. æª¢æŸ¥ API_BASE_URL æ˜¯å¦æ­£ç¢ºï¼ˆadmin.jsï¼‰
3. æª¢æŸ¥ CORS è¨­å®šï¼ˆserver.jsï¼‰
```

#### å•é¡Œ 2ï¼šFirebase æ¬Šé™éŒ¯èª¤
```
è§£æ±ºæ–¹æ³•ï¼š
1. ç¢ºèª Firebase æœå‹™å¸³è™Ÿé‡‘é‘°æ­£ç¢º
2. æª¢æŸ¥ .env æª”æ¡ˆé…ç½®
3. ç¢ºèª Firestore è¦å‰‡å…è¨±è®€å¯«
```

#### å•é¡Œ 3ï¼šåˆªé™¤å¤±æ•—
```
è§£æ±ºæ–¹æ³•ï¼š
1. æª¢æŸ¥çŽ©å®¶ ID æ˜¯å¦æ­£ç¢º
2. ç¢ºèª metadata æ–‡æª”å­˜åœ¨
3. æŸ¥çœ‹å¾Œç«¯æ—¥èªŒéŒ¯èª¤è¨Šæ¯
```

---

## ðŸ“ æœ€ä½³å¯¦è¸

1. **å®šæœŸç¶­è­·**
   - å®šæœŸæ¸…ç†ç„¡æ•ˆçŽ©å®¶
   - ç›£æŽ§è³‡æ–™åº«å¤§å°
   - æª¢æŸ¥ç•°å¸¸åˆ†æ•¸è¨˜éŒ„

2. **æ¸¬è©¦ç’°å¢ƒ**
   - åœ¨æ¸¬è©¦ç’°å¢ƒå…ˆé©—è­‰æ“ä½œ
   - ä½¿ç”¨æ¸¬è©¦è³‡æ–™ç·´ç¿’
   - ç†Ÿæ‚‰å„é …åŠŸèƒ½å¾Œå†æ“ä½œç”Ÿç”¢ç’°å¢ƒ

3. **æ–‡æª”è¨˜éŒ„**
   - è¨˜éŒ„æ¯æ¬¡é‡å¤§æ“ä½œ
   - ä¿ç•™åˆªé™¤çŽ©å®¶çš„è¨˜éŒ„
   - è¿½è¹¤åˆ†æ•¸é‡ç½®æ­·å²

4. **æ¬Šé™ç®¡ç†**
   - é™åˆ¶ç®¡ç†å¾Œå°è¨ªå•äººå“¡
   - ä½¿ç”¨ä¸åŒæ¬Šé™ç­‰ç´š
   - å®šæœŸå¯©æŸ¥è¨ªå•æ—¥èªŒ

---

## ðŸ”— ç›¸é—œé€£çµ

- Firebase Console: https://console.firebase.google.com/
- å¾Œç«¯ä¼ºæœå™¨æ–‡æª”: ../README.md
- API æ¸¬è©¦å·¥å…·: http://localhost:3000/leaderboard-test.html

---

## ðŸ“ž æ”¯æ´

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹æŸ¥çœ‹ï¼š
- å¾Œç«¯æ—¥èªŒï¼šæª¢æŸ¥ console è¼¸å‡º
- Firebase æ—¥èªŒï¼šFirebase Console > Functions æ—¥èªŒ
- ç³»çµ±ç‹€æ…‹ï¼šhttp://localhost:3000/api/health
