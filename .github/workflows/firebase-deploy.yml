name: è‡ªå‹•éƒ¨ç½²åˆ° Firebase

on:
  push:
    branches:
      - main
    paths:
      - 'frontend-nuxt/**'
      - 'functions/**'
      - 'firebase.json'
      - 'firestore.rules'
      - 'firestore.indexes.json'
      - 'storage.rules'
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout ä»£ç¢¼
        uses: actions/checkout@v4

      - name: ğŸŸ¢ è¨­ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: |
            frontend-nuxt/package-lock.json
            functions/package-lock.json

      - name: ğŸ“¦ å®‰è£ Frontend ä¾è³´
        working-directory: ./frontend-nuxt
        run: |
          rm -rf node_modules package-lock.json
          npm install

      - name: ğŸ”¨ æ§‹å»º Nuxt å°ˆæ¡ˆ
        working-directory: ./frontend-nuxt
        run: npm run build

      - name: ğŸ”§ å®‰è£ Firebase Tools
        run: npm install -g firebase-tools

      - name: ğŸš€ éƒ¨ç½²åˆ° Firebase Hosting
        run: firebase deploy --only hosting --token "${{ secrets.FIREBASE_TOKEN }}" --non-interactive --project side-project-663de

      - name: âœ… éƒ¨ç½²å®Œæˆé€šçŸ¥
        run: |
          echo "ğŸ‰ Hosting éƒ¨ç½²æˆåŠŸï¼"
          echo "ğŸ“± å°ˆæ¡ˆ: side-project-663de"
          echo "ğŸ”— æŸ¥çœ‹: https://side-project-663de.web.app"
