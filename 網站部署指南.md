# 🚀 網站部署指南

**更新時間**: 2025-10-31 17:07
**專案**: 愛心排行榜系統
**目標**: 部署到 Firebase Hosting

---

## 📋 部署前檢查清單

### ✅ 已完成
- [x] 程式碼修復完成（前後端衝突已解決）
- [x] 推送到 GitHub (https://github.com/GALLACE1111/mywebsite)
- [x] Git 工作目錄乾淨
- [x] Firebase 配置檔案正確（firebase.json, .firebaserc）
- [x] Firebase CLI 已安裝（v14.22.0）

### ⚠️ 待完成
- [ ] **Firebase 登入** ← 必須先完成
- [ ] **Firestore 資料庫啟用** ← 必須先完成（否則後端功能無法使用）
- [ ] 執行部署命令
- [ ] 驗證部署成功

---

## 🎯 部署步驟

### 步驟 1: Firebase 登入

**在命令提示字元（CMD）或 PowerShell 執行**:

```bash
cd D:\網頁\website
firebase login
```

**預期流程**:
1. 瀏覽器會自動開啟
2. 選擇你的 Google 帳號（與 Firebase 專案關聯的帳號）
3. 授權 Firebase CLI
4. 看到「Success! Logged in as your-email@gmail.com」

**驗證登入成功**:
```bash
firebase login:list
```

應該顯示你的 Google 帳號。

---

### 步驟 2: 啟用 Firestore（非常重要！）

如果還沒啟用 Firestore，**必須先完成這一步**：

1. **開啟 Firebase Console**:
   ```
   https://console.firebase.google.com/project/side-project-663de/firestore
   ```

2. **建立資料庫**:
   - 點擊「建立資料庫」按鈕
   - 選擇「**測試模式**」（30天有效）
   - 選擇地區：「**asia-east1 (台灣)**」
   - 等待 1-2 分鐘完成

3. **初始化測試資料**（可選）:
   ```bash
   cd D:\網頁\website\backend\nodejs
   node scripts/init-firestore.js
   ```

**為什麼必須啟用？**
目前後端所有功能都依賴 Firestore，如果不啟用：
- ❌ 排行榜無法載入
- ❌ 分數無法提交
- ❌ 用戶資料無法儲存

---

### 步驟 3: 部署到 Firebase Hosting

**部署前端（靜態檔案）**:

```bash
cd D:\網頁\website
firebase deploy --only hosting
```

**預期輸出**:
```
=== Deploying to 'side-project-663de'...

i  deploying hosting
✔  hosting[side-project-663de]: Hosting deployment complete
✔  Deploy complete!

Project Console: https://console.firebase.google.com/project/side-project-663de/overview
Hosting URL: https://side-project-663de.web.app
```

**部署時間**: 約 30 秒 - 2 分鐘

---

### 步驟 4: 驗證部署

1. **開啟網站**:
   ```
   https://side-project-663de.web.app
   ```

2. **測試功能**:
   - [ ] 頁面正常載入
   - [ ] 按下 F12 開啟開發者工具
   - [ ] 查看 Console 是否有錯誤
   - [ ] 排行榜是否顯示（需要 Firestore 啟用）
   - [ ] 點擊愛心是否能增加分數（需要 Firestore 啟用）

---

## 🔧 部署選項

### 選項 A: 僅部署前端（快速預覽）

如果 Firestore 尚未啟用，你可以先部署前端：

```bash
firebase deploy --only hosting
```

**優點**:
- 快速部署
- 可以看到 UI

**缺點**:
- 排行榜功能無法使用（顯示錯誤）
- 需要等 Firestore 啟用後才能完整測試

---

### 選項 B: 完整部署（推薦）

**先啟用 Firestore，再部署**：

1. 啟用 Firestore（步驟 2）
2. 部署 Hosting:
   ```bash
   firebase deploy --only hosting
   ```

**優點**:
- 所有功能立即可用
- 完整的用戶體驗

**缺點**:
- 需要先完成 Firestore 設定

---

### 選項 C: 部署所有服務（進階）

如果未來要部署 Cloud Functions、Firestore 規則等：

```bash
firebase deploy
```

**包含**:
- Hosting（前端）
- Firestore Rules（資料庫規則）
- Storage Rules（檔案儲存規則）
- Functions（如有配置）

---

## 🚨 常見問題

### Q1: 部署後看到「Quota exceeded」錯誤？

**原因**: Firestore 尚未啟用

**解決方法**: 按照「步驟 2」啟用 Firestore

---

### Q2: 部署失敗「Permission denied」？

**原因**: 未登入或權限不足

**解決方法**:
```bash
firebase login
firebase projects:list  # 檢查是否看到 side-project-663de
```

---

### Q3: 網站顯示 404 錯誤？

**原因**:
- Hosting 設定錯誤
- 檔案路徑不正確

**解決方法**:
檢查 `firebase.json`:
```json
{
  "hosting": {
    "public": "frontend",  // 確保這個目錄存在
    ...
  }
}
```

---

### Q4: 排行榜一直轉圈圈（Loading）？

**原因**:
- Firestore 未啟用
- 或網路連接問題

**解決方法**:
1. 開啟瀏覽器開發者工具（F12）
2. 查看 Console 錯誤訊息
3. 查看 Network 標籤，檢查 API 請求狀態

---

### Q5: 本地可以運作，部署後不行？

**檢查清單**:
1. **CORS 設定**:
   - `backend/nodejs/server.js` 的 CORS 設定是否正確
   - 目前設定為允許所有來源（`origin: '*'`）

2. **API URL**:
   - `frontend/config.js` 的 `API_BASE_URL` 是否正確
   - 目前設定為 `http://localhost:3000`

**修復**:
部署後，需要將 API 指向正確的後端 URL（如果後端也部署到 Firebase Functions）

---

## 📊 部署架構

### 當前架構（僅 Hosting）:

```
使用者瀏覽器
      ↓
Firebase Hosting（前端靜態檔案）
      ↓
本地 Node.js Server (localhost:3000)  ← 需要手動啟動
      ↓
Firebase Firestore
```

**限制**:
- 後端仍在本機運行
- 需要電腦持續開機
- 僅本地網路可訪問後端

---

### 未來架構（完整雲端）:

```
使用者瀏覽器
      ↓
Firebase Hosting（前端靜態檔案）
      ↓
Firebase Functions（後端 API）  ← 未來可遷移
      ↓
Firebase Firestore
```

**優點**:
- 完全雲端運行
- 自動擴展
- 無需維護伺服器

---

## 🎯 部署後的 URL

部署成功後，你的網站將可以通過以下 URL 訪問：

### 主要 URL:
```
https://side-project-663de.web.app
```

### 替代 URL:
```
https://side-project-663de.firebaseapp.com
```

### Firebase Console:
```
https://console.firebase.google.com/project/side-project-663de/overview
```

### Hosting 管理頁面:
```
https://console.firebase.google.com/project/side-project-663de/hosting
```

---

## 📝 部署後需要修改的地方

### 1. 更新前端 API URL

**檔案**: `frontend/config.js`

```javascript
// 目前（本地開發）:
const API_BASE_URL = 'http://localhost:3000';

// 未來（部署後端到 Firebase Functions）:
const API_BASE_URL = 'https://asia-east1-side-project-663de.cloudfunctions.net/api';

// 或者使用環境檢測（推薦）:
const API_BASE_URL = window.location.hostname === 'localhost'
  ? 'http://localhost:3000'
  : 'https://asia-east1-side-project-663de.cloudfunctions.net/api';
```

### 2. 更新 CORS 設定（如需要）

**檔案**: `backend/nodejs/server.js`

```javascript
// 開發環境（允許所有來源）:
app.use(cors({
  origin: '*'
}));

// 生產環境（限制來源）:
app.use(cors({
  origin: [
    'https://side-project-663de.web.app',
    'https://side-project-663de.firebaseapp.com'
  ]
}));
```

---

## 🔄 重新部署

修改程式碼後重新部署：

```bash
cd D:\網頁\website

# 1. 提交變更到 Git（可選）
git add .
git commit -m "更新部署設定"
git push

# 2. 重新部署到 Firebase
firebase deploy --only hosting
```

---

## 🎉 快速開始

**最簡單的部署流程**:

```bash
# 1. 登入 Firebase
cd D:\網頁\website
firebase login

# 2. 啟用 Firestore（在 Firebase Console 手動完成）
# https://console.firebase.google.com/project/side-project-663de/firestore

# 3. 部署前端
firebase deploy --only hosting

# 4. 開啟網站
# https://side-project-663de.web.app
```

---

## 📞 需要協助

如遇問題，請檢查：
1. Firebase Console 的部署記錄
2. 瀏覽器開發者工具的 Console 錯誤
3. `FIRESTORE_啟用指南.md` - Firestore 設定說明
4. `專案完整狀態.md` - 專案當前狀態

---

**部署指南完成** | 2025-10-31 17:07
